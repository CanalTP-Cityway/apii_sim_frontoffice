"use strict";function State(a,b){this._name=a,this._id=b}function FSMContext(a){this._state=a,this._previous_state=null,this._state_stack=[],this._transition=null,this._debug_flag=!1,this.debug_stream={}}function ActionState(){State.apply(this,arguments)}function MainMap_Default(){ActionState.apply(this,arguments)}function MainMap_Disconnected(){MainMap_Default.apply(this,arguments)}function MainMap_Connecting(){MainMap_Default.apply(this,arguments)}function MainMap_Connected(){MainMap_Default.apply(this,arguments)}function MainMap_Disconnecting(){MainMap_Default.apply(this,arguments)}function MainMap(){}function PlanTripMap_Default(){ActionState.apply(this,arguments)}function PlanTripMap_PlanTripRequest(){PlanTripMap_Default.apply(this,arguments)}function PlanTripMap_PlanTripResponse(){PlanTripMap_Default.apply(this,arguments)}function PlanTripMap_PlanTripNotification(){PlanTripMap_Default.apply(this,arguments)}function PlanTripMap_PlanTripCancellation(){PlanTripMap_Default.apply(this,arguments)}function PlanTripMap(){}function Action_sm(a){FSMContext.apply(this,arguments),this.setState(MainMap.Disconnected),this._owner=a}function Constant(){}State.mixin=function(a,b){for(var c in b)a[c]=b[c];return a},State.prototype=State.mixin(State.prototype,{getName:function(){return this._name},getId:function(){return this._id}}),FSMContext.prototype=State.mixin(FSMContext.prototype,{getDebugFlag:function(){return this._debug_flag},setDebugFlag:function(a){this._debug_flag=a},getDebugStream:function(){return this._debug_stream},setDebugStream:function(a){this._debug_stream=a},isInTransition:function(){return this._state?!1:!0},getTransition:function(){return this._transition},clearState:function(){this._previous_state=this._state,this._state=null},getPreviousState:function(){return this._previous_state},setState:function(a){if(!(a instanceof State))throw{err:a+" should be of class State"};this._state=a},isStateStackEmpty:function(){return 0===this._state_stack.length},getStateStackDepth:function(){return this._state_stack.length},pushState:function(a){if(!(a instanceof State))throw{err:a+" should be of class State"};this._state&&this._state_stack.push(this._state),this._state=a},popState:function(){this._state=this._state_stack.pop()},emptyStateStack:function(){this._state_stack=[]}}),angular.module("apiiSimFrontofficeApp",["ngAnimate","ngCookies","ngResource","ngSanitize","ngTouch","ngLocale","gettext","ui.router","angularMoment","ngStorage","ui.bootstrap","leaflet-directive"]).config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/home"),a.state("home",{url:"/home",views:{"":{templateUrl:"views/home.html"},"viewA@home":{templateUrl:"views/plantrip.html",controller:"PlantripCtrl"},"viewB@home":{templateUrl:"views/solution.html",controller:"SolutionCtrl"},"viewC@home":{templateUrl:"views/map.html",controller:"MapCtrl"},"viewD@home":{templateUrl:"views/detail.html",controller:"DetailCtrl"},"viewE@home":{templateUrl:"views/header.html"}}})}]),angular.module("gettext").run(["gettextCatalog",function(a){a.setStrings("fr",{AIR:"Avion",ALL:"Tous",AccessibilityConstraint:"Contraintes d'accessibilité",Arrival:"Arrivée",ArrivalAccessMode:"Mode d'accès à l'arrivée",ArrivalTime:"Arrivée",ArrivalTimeConstraint:"Horaire de départ",BIKE:"Vélo",BUS:"Bus",CABLE:"Funiculaire",CAR:"Voiture",Clear:"Netoyer",Close:"Fermer",Connection:"Correspondances",Contact:"Contact",Departure:"Départ",DepartureAccessMode:"Mode d'accès au départ",DepartureTime:"Départ",DepartureTimeConstraint:"Horaire d'arrivée",Detail:" Détails du trajet ",Direction:"Direction",Duration:"Durée",EmptyResponse:"Aucune solution pour votre recherche",EnterArrival:"Saisir votre destination",EnterDeparture:"Saisir votre adresse de départ",Line:"Ligne",METRO:"Métro",Parameters:"Paramètres",RAIL:"Rail",Reset:"Annuler",Searching:" Recherche en cours...",Solution:" Résultats de votre recherche",Submit:"Rechercher",TAXI:"Taxi",TRAM:"Tramway",Today:"Aujourd'hui",TransportMode:"Mode de transport",TripPlanner:" Recherche d'itinéraire",WATER:"Bateau",bicycle:"Vélo",car:"Voiture",foot:"Piéton"}),a.setStrings("en",{AIR:"AIR",ALL:"All",AccessibilityConstraint:"Wheelchair accessible",Arrival:"End",ArrivalAccessMode:"End transit options",ArrivalTime:"End",ArrivalTimeConstraint:"Depart at",BIKE:"Bike",BUS:"Bus",CABLE:"CABLE",CAR:"Car",Clear:"Clear",Close:"Close",Connection:"Linking number",Contact:"Contact",Departure:"Start",DepartureAccessMode:"Start transit options",DepartureTime:"Start",DepartureTimeConstraint:"Arrive by",Detail:"Trip Details",Direction:"Direction",Duration:"Duration",EmptyResponse:"No solution",EnterArrival:"Fill your end location",EnterDeparture:"Fill your start location",Line:"Line",Locale:"Language",METRO:"Subway",Parameters:"Preferences",Print:"Printing",RAIL:"Train",Reset:"Cancel",Searching:"Searching",Solution:"Solution",Submit:"Plan Trip",TAXI:"TAXI",TRAM:"Tramway",Today:"Today",TransportMode:"Transit options",TripPlanner:"Trip Plan",WATER:"WATER",bicycle:"Bike",car:"Car",foot:"Walk"}),a.setStrings("fr",{AIR:"Avion",ALL:"Tous",AccessibilityConstraint:"Contraintes d'accessibilité",Arrival:"Arrivée",ArrivalAccessMode:"Mode d'accès à l'arrivée",ArrivalTime:"Arrivée",ArrivalTimeConstraint:"Horaire de départ",BIKE:"Vélo",BUS:"Bus",CABLE:"Funiculaire",CAR:"Voiture",Clear:"Nettoyer",Close:"Fermer",Connection:"Correspondances",Contact:"Contact",Departure:"Départ",DepartureAccessMode:"Mode d'accès au départ",DepartureTime:"Départ",DepartureTimeConstraint:"Horaire d'arrivée",Detail:" Détails du trajet ",Direction:"Direction",Duration:"Durée",EmptyResponse:"Aucune solution pour votre recherche",EnterArrival:"Saisir votre destination",EnterDeparture:"Saisir votre adresse de départ",Line:"Ligne",Locale:"Langue",METRO:"Métro",Parameters:"Recherche avancée",Print:"Impression",RAIL:"Rail",Reset:"Annuler",Searching:" Recherche en cours...",Solution:" Résultats de votre recherche",Submit:"Rechercher",TAXI:"Taxi",TRAM:"Tramway",Today:"Aujourd'hui",TransportMode:"Mode de transport",TripPlanner:" Recherche d'itinéraire",WATER:"Bateau",bicycle:"Vélo",car:"Voiture",foot:"Piéton"})}]),ActionState.prototype=State.mixin(new State,{Entry:function(){},Exit_:function(){},cancellation:function(a){this.Default_(a)},close:function(a){this.Default_(a)},onClose:function(a){this.Default_(a)},onEndingSearch:function(a){this.Default_(a)},onError:function(a){this.Default_(a)},onOpen:function(a){this.Default_(a)},onPlanTripCancellationResponse:function(a){this.Default_(a)},onPlanTripExistenceNotificationResponse:function(a){this.Default_(a)},onPlanTripNotificationResponse:function(a){this.Default_(a)},onPlanTripResponseInvalid:function(a){this.Default_(a)},onPlanTripResponseValid:function(a){this.Default_(a)},onStartingSearch:function(a){this.Default_(a)},open:function(a){this.Default_(a)},request:function(a){this.Default_(a)},Default_:function(){}}),MainMap_Default.prototype=State.mixin(new ActionState,{open:function(){},close:function(a){var b=a.getOwner();a.getState().Exit_(a),a.clearState();var c=null;try{b.closing()}catch(c){}if(a.setState(MainMap.Disconnected),a.getState().Entry(a),c)throw c},onOpen:function(){},onClose:function(a){var b=a.getOwner();a.getState().Exit_(a),a.clearState();var c=null;try{b.closing()}catch(c){}if(a.setState(MainMap.Disconnected),a.getState().Entry(a),c)throw c},onError:function(a){var b=a.getOwner();a.getState().Exit_(a),a.clearState();var c=null;try{b.closing()}catch(c){}if(a.setState(MainMap.Disconnected),a.getState().Entry(a),c)throw c},request:function(){},cancellation:function(){},onPlanTripResponseValid:function(){},onPlanTripResponseInvalid:function(){},onPlanTripCancellationResponse:function(){},onStartingSearch:function(){},onPlanTripExistenceNotificationResponse:function(){},onPlanTripNotificationResponse:function(){},onEndingSearch:function(){}}),MainMap_Disconnected.prototype=State.mixin(new MainMap_Default,{open:function(a,b){var c=a.getOwner();a.getState().Exit_(a),a.clearState();var d=null;try{c.opening(b)}catch(d){}if(a.setState(MainMap.Connecting),a.getState().Entry(a),d)throw d}}),MainMap_Connecting.prototype=State.mixin(new MainMap_Default,{onOpen:function(a){a.getState().Exit_(a),a.setState(MainMap.Connected),a.getState().Entry(a),a.pushState(PlanTripMap.PlanTripRequest),a.getState().Entry(a)}}),MainMap_Connected.prototype=State.mixin(new MainMap_Default,{close:function(a){var b=a.getOwner();a.getState().Exit_(a),a.clearState();var c=null;try{b.closing()}catch(c){}if(a.setState(MainMap.Disconnected),a.getState().Entry(a),c)throw c},onClose:function(a){a.getState().Exit_(a),a.setState(MainMap.Disconnected),a.getState().Entry(a)},onError:function(a){a.getState().Exit_(a),a.setState(MainMap.Disconnected),a.getState().Entry(a)}}),MainMap_Disconnecting.prototype=State.mixin(new MainMap_Default,{onClose:function(a){a.getState().Exit_(a),a.setState(MainMap.Disconnected),a.getState().Entry(a)}}),MainMap.prototype=State.mixin({},{}),MainMap.Default_=new MainMap_Default("MainMap.Default_",-1),MainMap.Connected=new MainMap_Connected("MainMap.Connected",2),MainMap.Disconnecting=new MainMap_Disconnecting("MainMap.Disconnecting",3),MainMap.Disconnected=new MainMap_Disconnected("MainMap.Disconnected",0),MainMap.Connecting=new MainMap_Connecting("MainMap.Connecting",1),PlanTripMap_Default.prototype=State.mixin(new ActionState,{open:function(){},close:function(a){a.getState().Exit_(a),a.popState(),a.close()},onOpen:function(){},onClose:function(a){a.getState().Exit_(a),a.popState(),a.onClose()},onError:function(a){a.getState().Exit_(a),a.popState(),a.onError()},request:function(){},cancellation:function(){},onPlanTripResponseValid:function(){},onPlanTripResponseInvalid:function(){},onPlanTripCancellationResponse:function(){},onStartingSearch:function(){},onPlanTripExistenceNotificationResponse:function(){},onPlanTripNotificationResponse:function(){},onEndingSearch:function(){}}),PlanTripMap_PlanTripRequest.prototype=State.mixin(new PlanTripMap_Default,{request:function(a,b){var c=a.getOwner();a.getState().Exit_(a),a.clearState();var d=null;try{c.sendPlanTripRequest(b)}catch(d){}if(a.setState(PlanTripMap.PlanTripResponse),a.getState().Entry(a),d)throw d}}),PlanTripMap_PlanTripResponse.prototype=State.mixin(new PlanTripMap_Default,{Entry:function(a){var b=a.getOwner();b.entryPlanTripResponse()},Exit_:function(a){var b=a.getOwner();b.exitPlanTripResponse()},onPlanTripResponseInvalid:function(a,b){var c=a.getOwner();a.getState().Exit_(a),a.clearState();var d=null;try{c.receivePlanTripResponseInvalid(b)}catch(d){}if(a.setState(PlanTripMap.PlanTripRequest),a.getState().Entry(a),d)throw d},onPlanTripResponseValid:function(a,b){var c=a.getOwner();a.getState().Exit_(a),a.clearState();var d=null;try{c.receivePlanTripResponseValid(b)}catch(d){}if(a.setState(PlanTripMap.PlanTripNotification),a.getState().Entry(a),d)throw d}}),PlanTripMap_PlanTripNotification.prototype=State.mixin(new PlanTripMap_Default,{cancellation:function(a,b){var c=a.getOwner();a.getState().Exit_(a),a.clearState();var d=null;try{c.sendPlanTripCancellationRequest(b)}catch(d){}if(a.setState(PlanTripMap.PlanTripCancellation),a.getState().Entry(a),d)throw d},onEndingSearch:function(a,b){var c=a.getOwner();a.getState().Exit_(a),a.clearState();var d=null;try{c.receiveEndingSearch(b)}catch(d){}if(a.setState(PlanTripMap.PlanTripRequest),a.getState().Entry(a),d)throw d},onPlanTripExistenceNotificationResponse:function(a,b){var c=a.getOwner(),d=a.getState();a.clearState();var e=null;try{c.receivePlanTripExistenceNotificationResponse(b)}catch(e){}if(a.setState(d),e)throw e},onPlanTripNotificationResponse:function(a,b){var c=a.getOwner(),d=a.getState();a.clearState();var e=null;try{c.receivePlanTripNotificationResponse(b)}catch(e){}if(a.setState(d),e)throw e},onStartingSearch:function(a,b){var c=a.getOwner(),d=a.getState();a.clearState();var e=null;try{c.receiveStartingSearch(b)}catch(e){}if(a.setState(d),e)throw e}}),PlanTripMap_PlanTripCancellation.prototype=State.mixin(new PlanTripMap_Default,{Entry:function(a){var b=a.getOwner();b.entryPlanTripCancellation()},Exit_:function(a){var b=a.getOwner();b.exitPlanTripCancellation()},onEndingSearch:function(a,b){var c=a.getOwner();a.getState().Exit_(a),a.clearState();var d=null;try{c.receiveEndingSearch(b)}catch(d){}if(a.setState(PlanTripMap.PlanTripRequest),a.getState().Entry(a),d)throw d},onPlanTripCancellationResponse:function(a,b){var c=a.getOwner();a.getState().Exit_(a),a.clearState();var d=null;try{c.receivePlanTripCancellationResponse(b)}catch(d){}if(a.setState(PlanTripMap.PlanTripRequest),a.getState().Entry(a),d)throw d}}),PlanTripMap.prototype=State.mixin({},{}),PlanTripMap.Default_=new PlanTripMap_Default("PlanTripMap.Default_",-1),PlanTripMap.PlanTripResponse=new PlanTripMap_PlanTripResponse("PlanTripMap.PlanTripResponse",5),PlanTripMap.PlanTripCancellation=new PlanTripMap_PlanTripCancellation("PlanTripMap.PlanTripCancellation",7),PlanTripMap.PlanTripRequest=new PlanTripMap_PlanTripRequest("PlanTripMap.PlanTripRequest",4),PlanTripMap.PlanTripNotification=new PlanTripMap_PlanTripNotification("PlanTripMap.PlanTripNotification",6),Action_sm.prototype=State.mixin(new FSMContext,{cancellation:function(a){this._transition="cancellation",this.getState().cancellation(this,a),this._transition=null},close:function(){this._transition="close",this.getState().close(this),this._transition=null},onClose:function(){this._transition="onClose",this.getState().onClose(this),this._transition=null},onEndingSearch:function(a){this._transition="onEndingSearch",this.getState().onEndingSearch(this,a),this._transition=null},onError:function(){this._transition="onError",this.getState().onError(this),this._transition=null},onOpen:function(){this._transition="onOpen",this.getState().onOpen(this),this._transition=null},onPlanTripCancellationResponse:function(a){this._transition="onPlanTripCancellationResponse",this.getState().onPlanTripCancellationResponse(this,a),this._transition=null},onPlanTripExistenceNotificationResponse:function(a){this._transition="onPlanTripExistenceNotificationResponse",this.getState().onPlanTripExistenceNotificationResponse(this,a),this._transition=null},onPlanTripNotificationResponse:function(a){this._transition="onPlanTripNotificationResponse",this.getState().onPlanTripNotificationResponse(this,a),this._transition=null},onPlanTripResponseInvalid:function(a){this._transition="onPlanTripResponseInvalid",this.getState().onPlanTripResponseInvalid(this,a),this._transition=null},onPlanTripResponseValid:function(a){this._transition="onPlanTripResponseValid",this.getState().onPlanTripResponseValid(this,a),this._transition=null},onStartingSearch:function(a){this._transition="onStartingSearch",this.getState().onStartingSearch(this,a),this._transition=null},open:function(a){this._transition="open",this.getState().open(this,a),this._transition=null},request:function(a){this._transition="request",this.getState().request(this,a),this._transition=null},getState:function(){if(null==this._state)throw new StateUndefinedException;return this._state},enterStartState:function(){this._state.Entry(this)},getOwner:function(){return this._owner}}),angular.module("apiiSimFrontofficeApp").service("Sim",["$rootScope","$location","$q","$log","$timeout",function(a,b,c,d,e){var f={departure:{lng:parseFloat(0),lat:parseFloat(0)},arrival:{lng:parseFloat(0),lat:parseFloat(0)},plantrip:{request:null,response:null},responses:{starting:null,entries:[],ending:null},cancelation:{request:null,response:null}};a.model=f,this.context=new Action_sm(this),this.context.enterStartState(),this.socket=null,this.deferred=null,this.url=null,this.timer=null,this.clear=function(){a.model.plantrip.request=null,a.model.plantrip.response=null,a.model.responses.starting=null,a.model.responses.entries=[],a.model.responses.ending=null,a.model.cancelation.request=null,a.model.cancelation.response=null},this.send=function(d){var e=this;e.clear(),this.url="ws://"+b.host()+":"+b.port()+"/planner",a.debug&&(this.url="wss://www.apii-sim.fr/planner"),this.deferred=c.defer(),this.deferred.promise.then(function(){e.request(d)}),null==this.socket||3==this.socket.readyState?this.open(this.url):null!==this.deferred&&this.deferred.resolve(0)},this.open=function(a){this.context.open(a)},this.close=function(){d.info("[DSU] call close()"),this.context.close()},this.request=function(a){this.context.request(a)},this.cancellation=function(a){this.context.cancellation(a)},this.opening=function(b){this.socket=new WebSocket(b);var c=this;this.socket.onopen=function(){d.info("[DSU] call onopen()"),c.context.onOpen(),a.$apply(function(){null!==c.deferred&&c.deferred.resolve(0)})},this.socket.onclose=function(){d.info("[DSU] call onclose()"),c.context.onClose(),a.$apply(function(){null!==c.deferred&&(c.deferred.reject(1),c.deferred=null)})},this.socket.onerror=function(){d.info("[DSU] call onerror()"),c.context.onError(),a.$apply(function(){null!==c.deferred&&(c.deferred.reject(1),c.deferred=null)})},this.socket.onmessage=function(b){a.$apply(function(){var a=JSON.parse(b.data);d.info("[DSU] receive : "+JSON.stringify(a));var e=Object.keys(a)[0];switch(e){case"PlanTripResponse":0==a.PlanTripResponse.Status?c.context.onPlanTripResponseValid(a):c.context.onPlanTripResponseInvalid(a);break;case"AbstractResponseType":c.context.onPlanTripCancellationResponse(a);break;case"StartingSearch":c.context.onStartingSearch(a);break;case"PlanTripExistenceNotificationResponseType":c.context.onPlanTripExistenceNotificationResponse(a);break;case"PlanTripNotificationResponseType":c.context.onPlanTripNotificationResponse(a);break;case"EndingSearch":c.context.onEndingSearch(a)}})}},this.closing=function(){d.info("[DSU] call closing()"),null!=this.socket&&(this.socket.close(),this.socket=null)},this.sendPlanTripRequest=function(b){a.model.plantrip.request=b,null!==this.socket&&(d.warn("[DSU] send to "+this.url+" message : "+JSON.stringify(b)),this.socket.send(JSON.stringify(b)))},this.entryPlanTripResponse=function(){var a=this;this.timer&&(cancel(this.timer),this.timer=null),this.timer=e(function(){a.close()},3e3)},this.exitPlanTripResponse=function(){this.timer&&(e.cancel(this.timer),this.timer=null)},this.receivePlanTripResponseValid=function(b){a.model.plantrip.response=b},this.receivePlanTripResponseInvalid=function(b){a.model.plantrip.response=b},this.sendPlanTripCancellationRequest=function(b){a.model.cancelation.request=b,null!==this.socket&&(d.warn("[DSU] send to "+this.url+" message : "+JSON.stringify(b)),this.socket.send(JSON.stringify(b)))},this.entryPlanTripCancellation=function(){var a=this;this.timer&&(cancel(this.timer),this.timer=null),this.timer=e(function(){a.close()},3e3)},this.exitPlanTripCancellation=function(){this.timer&&(e.cancel(this.timer),this.timer=null)},this.receivePlanTripCancellationResponse=function(b){a.model.cancelation.response=b},this.receiveStartingSearch=function(b){a.model.responses.starting=b},this.receivePlanTripExistenceNotificationResponse=function(b){var c={header:b,body:null};a.model.responses.entries.push(c)},this.receivePlanTripNotificationResponse=function(b){for(var c=a.model.responses.entries,d=0;d<c.length;d++){var e=c[d].header.PlanTripExistenceNotificationResponseType.ComposedTripId;if(b.PlanTripNotificationResponseType.ComposedTrip.id==e){c[d].body=b;break}}},this.receiveEndingSearch=function(b){a.model.responses.ending=b;for(var c=a.model.responses.entries,d=c.length;d--;)null==c[d].body&&c.splice(d,1)}}]),angular.module("apiiSimFrontofficeApp").service("Config",["$q","$http",function(a,b){this.data=null,this.getConfig=function(){var c=a.defer();return null!=this.config?c.resolve(this.data):b.get("config.json").success(function(a){c.resolve(a)}).error(function(a,b){c.reject(b)}),c.promise}}]),angular.module("apiiSimFrontofficeApp").service("Locale",["$locale","gettextCatalog",function(a,b){this.data={fr:{DATETIME_FORMATS:{AMPMS:["AM","PM"],DAY:["dimanche","lundi","mardi","mercredi","jeudi","vendredi","samedi"],MONTH:["janvier","février","mars","avril","mai","juin","juillet","août","septembre","octobre","novembre","décembre"],SHORTDAY:["dim.","lun.","mar.","mer.","jeu.","ven.","sam."],SHORTMONTH:["janv.","févr.","mars","avr.","mai","juin","juil.","août","sept.","oct.","nov.","déc."],fullDate:"EEEE d MMMM y",longDate:"d MMMM y",medium:"d MMM y HH:mm:ss",mediumDate:"d MMM y",mediumTime:"HH:mm:ss","short":"dd/MM/y HH:mm",shortDate:"dd/MM/y",shortTime:"HH:mm"},NUMBER_FORMATS:{CURRENCY_SYM:"€",DECIMAL_SEP:",",GROUP_SEP:" ",PATTERNS:[{gSize:3,lgSize:3,maxFrac:3,minFrac:0,minInt:1,negPre:"-",negSuf:"",posPre:"",posSuf:""},{gSize:3,lgSize:3,maxFrac:2,minFrac:2,minInt:1,negPre:"-",negSuf:" ¤",posPre:"",posSuf:" ¤"}]},id:"fr"},en:{DATETIME_FORMATS:{AMPMS:["AM","PM"],DAY:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],MONTH:["January","February","March","April","May","June","July","August","September","October","November","December"],SHORTDAY:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],SHORTMONTH:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],fullDate:"EEEE, MMMM d, y",longDate:"MMMM d, y",medium:"MMM d, y h:mm:ss a",mediumDate:"MMM d, y",mediumTime:"h:mm:ss a","short":"M/d/yy h:mm a",shortDate:"M/d/yy",shortTime:"h:mm a"},NUMBER_FORMATS:{CURRENCY_SYM:"$",DECIMAL_SEP:".",GROUP_SEP:",",PATTERNS:[{gSize:3,lgSize:3,maxFrac:3,minFrac:0,minInt:1,negPre:"-",negSuf:"",posPre:"",posSuf:""},{gSize:3,lgSize:3,maxFrac:2,minFrac:2,minInt:1,negPre:"¤-",negSuf:"",posPre:"¤",posSuf:""}]},id:"en"}},this.setLocale=function(c){a.DATETIME_FORMATS=this.data[c].DATETIME_FORMATS,a.NUMBER_FORMATS=this.data[c].NUMBER_FORMATS,a.id=this.data[c].id,b.setCurrentLanguage(c),b.debug=!0},this.getLocale=function(){return a.id}}]),angular.module("apiiSimFrontofficeApp").controller("PlantripCtrl",["$scope","$rootScope","$log","$sessionStorage","$http","$location","$locale","gettextCatalog","Sim","Config",function(a,b,c,d,e,f,g,h,i,j){function k(){var c={d_lng:b.model.departure.lng,d_lat:b.model.departure.lat,a_lng:b.model.arrival.lng,a_lat:b.model.arrival.lat,time:new Date(a.$storage.arrivalDepartureTime).getTime(),a_time:a.$storage.arrivalDepartureTimeConstraint};f.search(c)}function l(){var c=f.search();c.d_lng&&(b.model.departure.lng=parseFloat(c.d_lng)),c.d_lat&&(b.model.departure.lat=parseFloat(c.d_lat)),c.a_lng&&(b.model.arrival.lng=parseFloat(c.a_lng)),c.a_lat&&(b.model.arrival.lat=parseFloat(c.a_lat)),c.time&&(a.$storage.arrivalDepartureTime=(new Date).setTime(c.time)),c.a_time&&(a.$storage.arrivalDepartureTimeConstraint=c.a_time)}function m(){var b=-1;a.model.responses.starting&&(b=a.model.responses.starting.StartingSearch.RequestId);var c={PlanTripCancellationRequest:{requestId:b}};return c}function n(){var b,c,d={PlanTripRequestType:{Departure:{Position:{Longitude:a.model.departure.lng,Latitude:a.model.departure.lat}},Arrival:{Position:{Longitude:a.model.arrival.lng,Latitude:a.model.arrival.lat}},MaxTrips:a.$storage.maxTrips,Algorithm:a.$storage.algorithm,modes:a.$storage.transportMode,selfDriveConditions:[],AccessibilityConstraint:a.$storage.accessibilityConstraint,Language:g.id,clientRequestId:(new Date).getTime()}};"false"===a.$storage.arrivalDepartureTimeConstraint?(delete d.PlanTripRequestType.ArrivalTime,b=moment(a.$storage.arrivalDepartureDate).format("YYYY-MM-DD"),c=moment(a.$storage.arrivalDepartureTime).format("HH:mm:ss"),d.PlanTripRequestType.DepartureTime=b+"T"+c):(delete d.PlanTripRequestType.DepartureTime,b=moment(a.$storage.arrivalDepartureDate).format("YYYY-MM-DD"),c=moment(a.$storage.arrivalDepartureTime).format("HH:mm:ss"),d.PlanTripRequestType.ArrivalTime=b+"T"+c);for(var e in a.$storage.departureAccessMode){var f={SelfDriveMode:a.$storage.departureAccessMode[e],TripPart:"DEPARTURE"};d.PlanTripRequestType.selfDriveConditions.push(f)}for(var h in a.$storage.arrivalAccessMode){var f={SelfDriveMode:a.$storage.arrivalAccessMode[h],TripPart:"ARRIVAL"};d.PlanTripRequestType.selfDriveConditions.push(f)}return d}function o(){j.getConfig().then(function(b){a.config=b}),a.opened=!1,a.$storage=d.$default(r),a.$storage.arrivalDepartureDate=new Date(a.$storage.arrivalDepartureDate),a.$storage.arrivalDepartureTime=new Date(a.$storage.arrivalDepartureTime),l()}a.lang="fr",a.minDate=new Date;var p="http://nominatim.openstreetmap.org/search",q="http://nominatim.openstreetmap.org/reverse",r={departure:"",departurePlace:void 0,arrival:"",arrivalPlace:void 0,arrivalDepartureTimeConstraint:"false",arrivalDepartureDate:new Date,arrivalDepartureTime:new Date,accessibilityConstraint:!1,maxTrips:5,transportMode:["ALL"],algorithm:"CLASSIC",language:g.id,departureAccessMode:[],arrivalAccessMode:[]};a.open=function(b){b.preventDefault(),b.stopPropagation(),a.opened=!a.opened},a.execute=function(){i.cancellation(m()),i.clear(),b.$broadcast("solution",-1,null),k(),i.send(n())},a.reset=function(){i.cancellation(m()),d.$reset(),a.$storage=d.$default(r),a.model.departure.lng=0,a.model.departure.lat=0,a.model.arrival.lng=0,a.model.arrival.lat=0,a.$storage.arrivalDepartureDate=new Date,a.$storage.arrivalDepartureTime=new Date,f.search({}),i.clear(),b.$broadcast("solution",-1,null),b.$broadcast("reset")},a.reverse=function(){var b=a.model.departure.lng,c=a.model.departure.lat;a.model.departure.lng=a.model.arrival.lng,a.model.departure.lat=a.model.arrival.lat,a.model.arrival.lng=b,a.model.arrival.lat=c},a.onSelectDeparture=function(b){a.$storage.departurePlace=b},a.onSelectArrival=function(b){a.$storage.arrivalPlace=b},a.$watch("$storage.departurePlace",function(a){a&&(b.model.departure.lng=parseFloat(a.lon),b.model.departure.lat=parseFloat(a.lat))}),a.$watch("$storage.arrivalPlace",function(a){a&&(b.model.arrival.lng=parseFloat(a.lon),b.model.arrival.lat=parseFloat(a.lat))}),a.$watch("model.departure",function(b){isNaN(b.lng)||isNaN(b.lat)||(void 0===a.$storage.departurePlace||b.lng!=a.$storage.departurePlace.lon||b.lat!=a.$storage.departurePlace.lat)&&(0!=b.lat||0!=b.lng)&&a.getReverseAddresses(b.lng,b.lat,function(b){a.$storage.departurePlace=b.data,a.$storage.departure=a.formatAddresses(b.data)})},!0),a.$watch("model.arrival",function(b){isNaN(b.lng)||isNaN(b.lat)||(void 0===a.$storage.arrivalPlace||b.lng!=a.$storage.arrivalPlace.lon||b.lat!=a.$storage.arrivalPlace.lat)&&(0!=b.lat||0!=b.lng)&&a.getReverseAddresses(b.lng,b.lat,function(b){a.$storage.arrivalPlace=b.data,a.$storage.arrival=a.formatAddresses(b.data)})},!0),a.onTransportModeChange=function(a,b){for(var c=Constant.toTransportMode(b),d=0;d<c.length;d++){var e=a.indexOf(c[d]);-1===e?a.push(c[d]):a.splice(e,1)}},a.onAccessModeChange=function(a,b){for(var c=Constant.toAccessMode(b),d=0;d<c.length;d++){var e=a.indexOf(c[d]);-1===e?a.push(c[d]):a.splice(e,1)}},a.isItemSelected=function(a,b){return-1!==a.indexOf(b)},a.getAddresses=function(b){var c="-180,90,180,-90";return void 0!==a.config&&(c=a.config.bounds[0][1].toString()+","+a.config.bounds[1][0].toString()+","+a.config.bounds[1][1].toString()+","+a.config.bounds[0][0].toString()),e.get(p,{params:{q:b,addressdetails:1,countrycodes:"fr",zoom:18,format:"json",bounded:1,viewbox:c}}).then(function(b){var c=b.data.filter(a.filterAddresses).map(a.updateAddresses);return c})},a.filterAddresses=function(a){var b=["boundary"==a["class"]&&"administrative"==a.type&&a.address.city,"place"==a["class"]&&("hamlet"==a.type||"house"==a.type||"city"==a.type||"locality"==a.type),"building"==a["class"],"highway"==a["class"]];return b.some(function(a){return a},this)},a.updateAddresses=function(b){return b.label=a.formatAddresses(b),b},a.formatAddresses=function(a){var b=a.address,c="";return b?(c+=b.place_of_worship||b.station||b.bus_stop||b.information||b.address26||b.building||"",c+=" ",c+=b.house_number||"",c+=" ",c+=b.cycleway||b.road||b.address26||b.pedestrian||"",c+=" ",c+=b.postcode||"",c+=" ",c+=b.city_district||b.city||b.town||b.village||b.hamlet||"",c+=" ",c+=b.state||b.country||""):c=a.display_name,c},a.getReverseAddresses=function(a,b,c){return e.get(q,{params:{lon:a,lat:b,zoom:18,addressdetails:1,format:"json"}}).then(c)},a.arrivalDepartureTimeHasError=function(b,c){var d=new Date,e=new Date(d.getFullYear(),d.getMonth(),d.getDate(),0,0,0,0);if(!a.$storage.arrivalDepartureDate)return!0;var f=moment(a.$storage.arrivalDepartureDate).toDate(),g=new Date(f.getFullYear(),f.getMonth(),f.getDate(),0,0,0,0);return g.getTime()-e.getTime()<0?!0:a.hasError(b,c)},a.hasError=function(b,c){void 0===c&&(c=[b]);var d=a.plantripForm[b],e=!1;if(void 0!==a.model&&null!==a.model.plantrip.response&&0!=a.model.plantrip.response.PlanTripResponse.Status){var f=a.model.plantrip.response.PlanTripResponse.errors;a:for(var g in f)for(var h in c)if(f[g].Field===c[h]){e=!0,e&&(d.$dirty=!0);break a}}return d.$invalid||e},a.errorMessage=function(b,c){var d="";if(void 0===c&&(c=[b]),void 0!==a.model&&null!==a.model.plantrip.response&&0!=a.model.plantrip.response.PlanTripResponse.Status){var e=a.model.plantrip.response.PlanTripResponse.errors;a:for(var f in e)for(var g in c)if(e[f].Field==b){d=e[f].Message;break a}}return d},o()}]),angular.module("apiiSimFrontofficeApp").controller("HomeCtrl",["$scope","$rootScope","$log","Locale","$window","$timeout","$location","Config",function(a,b,c,d,e,f,g,h){function i(){d.setLocale("fr"),h.getConfig().then(function(a){b.config=a}),b.debug=9e3===g.port()?!0:!1}a.groups=[{open:!0},{open:!1}],a.disabled=!0,a.$watch("model.responses.starting",function(b){b&&(a.groups[1].open=!0)}),a.setLocale=function(a){d.setLocale(a)},a.getLocale=function(){return d.getLocale()},a.$watch("model.departure",function(){a.groups[0].open=!0},!0),a.$watch("model.arrival",function(){a.groups[0].open=!0},!0),a.$on("solution",function(b,c){a.disabled=c>=0?!1:!0}),a.print=function(){$.print("#map",{append:"#print-detail"})},i()}]),angular.module("apiiSimFrontofficeApp").controller("MapCtrl",["$scope","$rootScope","$log","Sim","leafletData","$timeout","gettextCatalog","Config","$compile",function(a,b,c,d,e,f,g,h,i){function j(){var c="http://{s}.tile.osm.org/{z}/{x}/{y}.png";b.debug&&(c="http://{s}.tile.osm.org/{z}/{x}/{y}.png");var d={default_icon:{},marker_green:{iconUrl:"images/marker-green.png",shadowUrl:"images/marker-shadow.png",iconSize:[25,41],shadowSize:[41,41],iconAnchor:[12,41],popupAnchor:[1,-34]},marker_red:{iconUrl:"images/marker-red.png",shadowUrl:"images/marker-shadow.png",iconSize:[25,41],shadowSize:[41,41],iconAnchor:[12,41],popupAnchor:[1,-34]}};angular.extend(b.model.departure,{icon:d.marker_green,focus:!1,zIndexOffset:1e3,draggable:!0}),angular.extend(b.model.arrival,{icon:d.marker_red,focus:!1,zIndexOffset:1e3,draggable:!0}),angular.extend(a,{center:{lat:46.76844,lng:2.432613,zoom:6},defaults:{tileLayer:c,maxZoom:19,zoomControl:!0,zoomControlPosition:"topright",path:{}},icons:d,markers:{},paths:{},events:{map:{enable:["contextmenu"],logic:"emit"},path:{enable:["click"],logic:"emit"}},solution:{},detail:{}}),h.getConfig().then(function(a){e.getMap().then(function(b){b.fitBounds(a.bounds)})})}function k(a,b){e.getMap().then(function(c){var d=a.getCenter(),e=c.latLngToContainerPoint(d),f=c.containerPointToLatLng([e.x-b,e.y]),g=c.getBoundsZoom(a);c.setView(f,g-1,{animate:!1})})}function l(a,b){var c=Math.min(a.TripStopPlace.Position.Longitude,b.TripStopPlace.Position.Longitude),d=Math.max(a.TripStopPlace.Position.Longitude,b.TripStopPlace.Position.Longitude),e=Math.min(a.TripStopPlace.Position.Latitude,b.TripStopPlace.Position.Latitude),f=Math.max(a.TripStopPlace.Position.Latitude,b.TripStopPlace.Position.Latitude),g=L.latLngBounds(L.latLng(e,c),L.latLng(f,d));return g}function m(){if(p(),a.solution.data&&a.solution.data.body)for(var b=a.solution.data.body.PlanTripNotificationResponseType.ComposedTrip.sections,c=null,d=null,e=null,f=0;f<b.length;f++){var g=null,h=null,i=0,j=null;b[f].PTRide&&(c=b[f].PTRide,g=c.steps,i=0,j=c.PublicTransportMode),b[f].Leg&&(c=b[f].Leg,g=c.steps,i=1,j="foot"),h=c.Departure,null===e&&(e=h);var k=n(c,d,e,h,0,j);a.markers["m_"+f+"_0"]=k,f===b.length-1&&(k=n(c,d,c.Arrival,c.Arrival,0,j),a.markers["m_"+f+"_1"]=k);
var l={stroke_color:"#03f",stroke_weight:5,opacity:.6,title:c.Line?c.Line.Number:"",latlngs:[]};if("foot"===j&&(l.stroke_color="#0f0"),l.color=l.stroke_color,l.weight=l.stroke_weight,g)for(var m=0;m<g.length;m++){d=g[m],h=d.Departure,m>0&&m<g.length&&(k=n(c,d,e,h,1,j),a.markers["m_"+f+"_"+m+"_0"]=k),e=d.Arrival;var o=d.Departure.TripStopPlace.Position.Longitude,q=d.Departure.TripStopPlace.Position.Latitude;0!==o&&0!==q&&l.latlngs.push({lat:q,lng:o}),o=d.Arrival.TripStopPlace.Position.Longitude,q=d.Arrival.TripStopPlace.Position.Latitude,0!==o&&0!==q&&l.latlngs.push({lat:q,lng:o})}else l.latlngs.push({lat:c.Departure.TripStopPlace.Position.Latitude,lng:c.Departure.TripStopPlace.Position.Longitude}),l.latlngs.push({lat:c.Arrival.TripStopPlace.Position.Latitude,lng:c.Arrival.TripStopPlace.Position.Longitude});a.paths["p_"+f]=l,e=c.Arrival}}function n(a,b,c,d,e,f){var g=d.TripStopPlace.Position.Longitude,h=d.TripStopPlace.Position.Latitude,i=d.TripStopPlace.Name,j=d.TripStopPlace.CityName||"",k=a.Line?a.Line.Number+" - "+a.Line.Name:"",l=a.StopHeadSign||"",m={lng:g,lat:h,title:i,type:"div",icon:{type:"div",className:"div-icon circle "+(1===e?"circle-1":"circle-0"),html:'<span class="'+Constant.toIconClass(f)+'">',iconSize:[20,20]},focus:!1,draggable:!1,data:{name:i,city_name:j||"",arrival:c.DateTime,departure:d.DateTime,mode:f,line:k||"",direction:l}};return m}function o(a){var b=Constant.toIconClass(a.data.mode),c=moment.duration(a.data.arrival).format("h [h] m [min]"),d=moment.duration(a.data.departure).format("h [h] m [min]"),e="";"foot"!==a.data.mode&&(e='<div class="popup-header"><div><i class="'+b+'"></i>{{ "Line" | translate}} '+a.data.line+"</div>",e+=a.data.direction?'<div>{{ "Direction" | translate}} '+a.data.direction+"</div>":"",e+="</div>");var f='<div id="popup">'+e+"<div><strong>"+a.data.name+"</strong></div><div>"+a.data.city_name+'</div><div class="arrival"><div><span class="glyphicon glyphicon-flag"></span>{{ "Arrival" | translate}} '+c+'</div></div><div class="departure"><div><span class="glyphicon glyphicon-flag"></span>{{ "Departure" | translate}} '+d+"</div></div></div>";return f}function p(){a.paths={};for(var b in a.markers)"arrival"!==b&&"departure"!==b&&delete a.markers[b]}a.setDeparture=function(a,c){e.getMap().then(function(a){a.closePopup()}),b.model.departure.lng=parseFloat(a),b.model.departure.lat=parseFloat(c)},a.setArrival=function(a,c){e.getMap().then(function(a){a.closePopup()}),b.model.arrival.lng=parseFloat(a),b.model.arrival.lat=parseFloat(c)},a.$watch("model.departure",function(b){b&&!a.markers.departure&&(isNaN(b.lat)||isNaN(b.lng)||(0!=b.lat||0!=b.lng)&&(a.markers.departure=b))},!0),a.$watch("model.arrival",function(b){b&&!a.markers.arrival&&(isNaN(b.lat)||isNaN(b.lng)||(0!=b.lat||0!=b.lng)&&(a.markers.arrival=b))},!0),a.$on("leafletDirectivePath.click",function(a,c){"p_"===c.pathName.substr(0,2)&&b.$broadcast("map",c.pathName.slice(2))}),a.$on("leafletDirectiveMap.contextmenu",function(b,c){e.getMap().then(function(b){var d=c.leafletEvent.latlng,e='<div class="btn-group" role="group"><div><img src="images/marker-green.png" height="20" width="12"/><a class="btn btn-link" ng-click="setDeparture('+d.lng+","+d.lat+')" translate >Departure</a></div><div><img src="images/marker-red.png"  height="20" width="12"/><a class="btn btn-link" ng-click="setArrival('+d.lng+","+d.lat+')" translate >Arrival</a></div></div>',f=i(angular.element(e)),g=f(a)[0],h=L.popup({maxWidth:83,closeButton:!1});h.setContent(g),h.setLatLng(d),h.openOn(b)})}),a.$on("leafletDirectiveMarker.click",function(b,c){"arrival"!==c.markerName&&"departure"!==c.markerName&&e.getMap().then(function(b){var d=c.leafletEvent.latlng,e=a.markers[c.markerName];if(e){var f=o(e),g=i(angular.element(f)),h=g(a)[0],j=L.popup({closeButton:!1});j.setContent(h),j.setLatLng(d),j.openOn(b)}})}),a.$on("reset",function(){h.getConfig().then(function(a){e.getMap().then(function(b){b.fitBounds(a.bounds)})})}),a.$on("solution",function(b,c,d){a.solution.index=c,a.solution.data=d,m()}),a.$on("detail",function(b,c,d){a.detail.index=c,a.detail.data=d;var e=null;e=d.Leg?l(d.Leg.Departure,d.Leg.Arrival):l(d.PTRide.Departure,d.PTRide.Arrival);var f=($("#solution").offset().left+$("#solution").width())/2;k(e,f);for(var g in a.paths)a.paths[g].color=a.paths[g].stroke_color,a.paths[g].weight=a.paths[g].stroke_weight;a.paths["p_"+c]&&(a.paths["p_"+c].color="#777",a.paths["p_"+c].weight=7)}),j()}]),angular.module("apiiSimFrontofficeApp").controller("SolutionCtrl",["$scope","$rootScope","$log",function(a,b){a.onSelect=function(c){a.selected=c;var d=a.model.responses.entries[c];b.$broadcast("solution",c,d)},a.getConnectionCounter=function(a){var b="",c=0;if(a&&a.body){var d=a.body.PlanTripNotificationResponseType.ComposedTrip.sections;if(d){for(var e=0;e<d.length;e++)d[e].Leg&&c++;d[0].Leg&&c--,d[d.length-1].Leg&&c--,b=0>c?0:c}}return b},a.hasError=function(){return a.model.responses.ending&&0==a.model.responses.ending.EndingSearch.NotificationsSent}}]),angular.module("apiiSimFrontofficeApp").controller("DetailCtrl",["$scope","$rootScope","$log",function(a,b){a.$on("solution",function(b,c,d){a.index=c,a.data=d}),a.$on("map",function(b,c){a.onSelect(c)}),a.onSelect=function(c){a.selected=c;var d=a.data.body.PlanTripNotificationResponseType.ComposedTrip.sections[c];b.$broadcast("detail",c,d)},a.getWaiting=function(b){var c=0,d=a.data.body.PlanTripNotificationResponseType.ComposedTrip.sections,e=d[b],f=null;b+1<d.length&&(f=d[b+1]);var g=null;e.Leg?g=moment(e.Leg.Arrival.DateTime,"YYYY-MM-DDTHH:mm:ss"):e.PTRide&&(g=moment(e.PTRide.Arrival.DateTime,"YYYY-MM-DDTHH:mm:ss"));var h=null;return f?(f.Leg?h=moment(f.Leg.Departure.DateTime,"YYYY-MM-DDTHH:mm:ss"):f.PTRide&&(h=moment(f.PTRide.Departure.DateTime,"YYYY-MM-DDTHH:mm:ss")),g&&h&&(c=h.diff(g))):c=0,c},a.getIconClass=function(a){return Constant.toIconClass(a)},a.getElapsedTime=function(b){var c=0,d=a.data.body.PlanTripNotificationResponseType.ComposedTrip.sections,e=d[b],f=null;b+1<d.length&&(f=d[b+1]);var g=null,h=null;if(e.Leg?(g=moment(e.Leg.Departure.DateTime,"YYYY-MM-DDTHH:mm:ss"),h=moment(e.Leg.Arrival.DateTime,"YYYY-MM-DDTHH:mm:ss")):e.PTRide&&(g=moment(e.PTRide.Departure.DateTime,"YYYY-MM-DDTHH:mm:ss"),h=moment(e.PTRide.Arrival.DateTime,"YYYY-MM-DDTHH:mm:ss")),f){var i=null;f.Leg?i=moment(f.Leg.Departure.DateTime,"YYYY-MM-DDTHH:mm:ss"):f.PTRide&&(i=moment(f.PTRide.Departure.DateTime,"YYYY-MM-DDTHH:mm:ss")),g&&i&&(c=i.diff(g))}else c=h.diff(g);return c}}]),angular.module("apiiSimFrontofficeApp").filter("plantripDurationFormat",["moment",function(a){return function(b,c){return"undefined"==typeof b||null===b?"":a.duration(b).format(c)}}]),Constant.TRANSPORT_MODE={ALL:["ALL"],BUS:["BUS","COACH","TROLLEYBUS"],TRAM:["TRAM"],RAIL:["RAIL","URBANRAIL","INTERCITYRAIL"],METRO:["METRO"],AIR:["AIR"],WATER:["WATER"],CABLE:["CABLE","FUNICULAR"],TAXI:["TAXI"],BIKE:["BIKE"],CAR:["CAR"]},Constant.ACCESS_MODE={foot:["foot"],car:["car","taxi","shuttle","boat"],bicycle:["bicycle"]},Constant.toIconClass=function(a){var b="",c=Constant.fromTransportMode(a);return b=c?"icon-"+c.toLowerCase():"icon-"+a.toLowerCase()},Constant.toTransportMode=function(a){return Constant.TRANSPORT_MODE[a]},Constant.fromTransportMode=function(a){var b=null;a:for(var c in Constant.TRANSPORT_MODE)for(var d=Constant.TRANSPORT_MODE[c],e=0;e<d.length;e++){var f=d[e];if(f===a){b=c;break a}}return b},Constant.toAccessMode=function(a){return Constant.ACCESS_MODE[a]},Constant.fromAccessMode=function(a){var b=null;a:for(var c in Constant.ACCESS_MODE)for(var d=Constant.ACCESS_MODE[c],e=0;e<d.length;e++){var f=d[e];if(f===a){b=c;break a}}return b};